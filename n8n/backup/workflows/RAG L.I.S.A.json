{
  "name": "RAG L.I.S.A.",
  "nodes": [
    {
      "parameters": {
        "jsonMode": "expressionData",
        "jsonData": "={{ $json.data || $json.text || $json.concatenated_data }}",
        "options": {
          "metadata": {
            "metadataValues": [
              {
                "name": "=file_id",
                "value": "={{ $('ID —Ñ–∞–π–ª–∞').first().json.file_id }}"
              },
              {
                "name": "file_title",
                "value": "={{ $('ID —Ñ–∞–π–ª–∞').first().json.file_title }}"
              }
            ]
          }
        }
      },
      "id": "c240af86-89f6-4220-9155-f9778527ef42",
      "name": "–ó–∞–≥—Ä—É–∑—á–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤",
      "type": "@n8n/n8n-nodes-langchain.documentDefaultDataLoader",
      "typeVersion": 1,
      "position": [
        -1696,
        0
      ]
    },
    {
      "parameters": {
        "operation": "text",
        "options": {}
      },
      "id": "05b59dd6-6c6e-4fd2-a810-18dc600d93a6",
      "name": "–ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç (TXT)",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -2480,
        -224
      ],
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "10646eae-ae46-4327-a4dc-9987c2d76173",
              "name": "file_id",
              "value": "={{ $json.path }}",
              "type": "string"
            },
            {
              "id": "f4536df5-d0b1-4392-bf17-b8137fb31a44",
              "name": "file_type",
              "value": "={{ $json.path.split(/[\\\\/]/).pop().split('.').pop(); }}",
              "type": "string"
            },
            {
              "id": "77d782de-169d-4a46-8a8e-a3831c04d90f",
              "name": "file_title",
              "value": "={{ $json.path.split(/[\\\\/]/).pop().split('.').slice(0, -1).join('.'); }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "3085af91-1418-4b15-83a5-0193461cffbc",
      "name": "ID —Ñ–∞–π–ª–∞",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -3488,
        -320
      ]
    },
    {
      "parameters": {
        "operation": "pdf",
        "options": {}
      },
      "id": "e873f27e-afa2-4b98-bb03-1920b05183a7",
      "name": "–ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç (PDF)",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -2480,
        -48
      ]
    },
    {
      "parameters": {
        "aggregate": "aggregateAllItemData",
        "options": {}
      },
      "id": "6630ad11-2d4f-46f5-bc23-07dca5aaaf83",
      "name": "–ê–≥—Ä–µ–≥–∞—Ü–∏—è",
      "type": "n8n-nodes-base.aggregate",
      "typeVersion": 1,
      "position": [
        -2144,
        -560
      ]
    },
    {
      "parameters": {
        "fieldsToSummarize": {
          "values": [
            {
              "aggregation": "concatenate",
              "field": "data"
            }
          ]
        },
        "options": {}
      },
      "id": "42806db2-c660-4271-80db-0a1f47826f1a",
      "name": "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å",
      "type": "n8n-nodes-base.summarize",
      "typeVersion": 1,
      "position": [
        -1904,
        -480
      ]
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "fc193b06-363b-4699-a97d-e5a850138b0e",
                    "leftValue": "={{ $('ID —Ñ–∞–π–ª–∞').item.json.file_type }}",
                    "rightValue": "=csv",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "csv"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "2ae7faa7-a936-4621-a680-60c512163034",
                    "leftValue": "={{ $('ID —Ñ–∞–π–ª–∞').item.json.file_type }}",
                    "rightValue": "xlsx",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "xlsx"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "id": "b69f5605-0179-4b02-9a32-e34bb085f82d",
                    "leftValue": "={{ $('ID —Ñ–∞–π–ª–∞').item.json.file_type }}",
                    "rightValue": "txt",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "txt"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 1
                },
                "conditions": [
                  {
                    "leftValue": "={{ $('ID —Ñ–∞–π–ª–∞').item.json.file_type }}",
                    "rightValue": "pdf",
                    "operator": {
                      "type": "string",
                      "operation": "equals"
                    },
                    "id": "81a2f32c-1a39-4b4c-b146-301c5a71ce33"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "pdf"
            }
          ]
        },
        "options": {
          "fallbackOutput": "extra"
        }
      },
      "id": "94afd27b-6ca4-4656-b8a8-915fc8035372",
      "name": "–¢–∏–ø —Ñ–∞–π–ª–∞",
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3,
      "position": [
        -2752,
        -320
      ]
    },
    {
      "parameters": {
        "operation": "xlsx",
        "options": {}
      },
      "id": "b512b4ba-c276-4c74-a613-49eb343f540f",
      "name": "–ò–∑–≤–ª–µ—á—å –∏–∑ Excel",
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -2496,
        -384
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "f422e2e0-381c-46ea-8f38-3f58c501d8b9",
              "name": "schema",
              "value": "={{ $('–ò–∑–≤–ª–µ—á—å –∏–∑ Excel').isExecuted ? $('–ò–∑–≤–ª–µ—á—å –∏–∑ Excel').first().json.keys().toJsonString() : $('–ò–∑–≤–ª–µ—á—å –∏–∑ CSV').first().json.keys().toJsonString() }}",
              "type": "string"
            },
            {
              "id": "bb07c71e-5b60-4795-864c-cc3845b6bc46",
              "name": "data",
              "value": "={{ $json.concatenated_data }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1664,
        -624
      ],
      "id": "8ca1e4c6-f24e-428a-9e19-b5c9c721fb96",
      "name": "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.extractFromFile",
      "typeVersion": 1,
      "position": [
        -2496,
        -560
      ],
      "id": "cf8008e9-b93b-4cc0-a245-2f90b5cae377",
      "name": "–ò–∑–≤–ª–µ—á—å –∏–∑ CSV"
    },
    {
      "parameters": {
        "options": {
          "reset": false
        }
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        -3680,
        -192
      ],
      "id": "eaf0fb93-8911-487a-a675-533fbbf5d224",
      "name": "–¶–∏–∫–ª –ø–æ —Ñ–∞–π–ª–∞–º"
    },
    {
      "parameters": {
        "operation": "upsert",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "document_metadata",
          "mode": "list",
          "cachedResultName": "document_metadata"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('ID —Ñ–∞–π–ª–∞').item.json.file_id }}",
            "title": "={{ $('ID —Ñ–∞–π–ª–∞').item.json.file_title }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": true,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "title",
              "displayName": "title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": false
            },
            {
              "id": "schema",
              "displayName": "schema",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": true
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -3040,
        -192
      ],
      "id": "5bcf0381-e8e4-466a-8a14-3608be5341d2",
      "name": "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ",
      "executeOnce": true,
      "credentials": {
        "postgres": {
          "id": "EbeJgvGxJbetfB8O",
          "name": "Postgres local"
        }
      }
    },
    {
      "parameters": {
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "document_rows",
          "mode": "list",
          "cachedResultName": "document_rows"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "dataset_id": "={{ $('ID —Ñ–∞–π–ª–∞').item.json.file_id }}",
            "row_data": "={{ $json.toJsonString().replaceAll(/'/g, \"''\") }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": false,
              "defaultMatch": true,
              "display": true,
              "type": "number",
              "canBeUsedToMatch": true,
              "removed": true
            },
            {
              "id": "dataset_id",
              "displayName": "dataset_id",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "row_data",
              "displayName": "row_data",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "object",
              "canBeUsedToMatch": true,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -2144,
        -384
      ],
      "id": "28e380ae-2a02-4eb6-9f7e-08d240f2eb7b",
      "name": "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä–æ–∫–∏",
      "credentials": {
        "postgres": {
          "id": "EbeJgvGxJbetfB8O",
          "name": "Postgres local"
        }
      }
    },
    {
      "parameters": {
        "operation": "upsert",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "document_metadata",
          "mode": "list",
          "cachedResultName": "document_metadata"
        },
        "columns": {
          "mappingMode": "defineBelow",
          "value": {
            "id": "={{ $('ID —Ñ–∞–π–ª–∞').item.json.file_id }}",
            "schema": "={{ $json.schema }}"
          },
          "matchingColumns": [
            "id"
          ],
          "schema": [
            {
              "id": "id",
              "displayName": "id",
              "required": true,
              "defaultMatch": true,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": true,
              "removed": false
            },
            {
              "id": "title",
              "displayName": "title",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": true
            },
            {
              "id": "url",
              "displayName": "url",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": true
            },
            {
              "id": "created_at",
              "displayName": "created_at",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "dateTime",
              "canBeUsedToMatch": false
            },
            {
              "id": "schema",
              "displayName": "schema",
              "required": false,
              "defaultMatch": false,
              "display": true,
              "type": "string",
              "canBeUsedToMatch": false,
              "removed": false
            }
          ],
          "attemptToConvertTypes": false,
          "convertFieldsToString": false
        },
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -1440,
        -624
      ],
      "id": "b22f0ff8-6447-4b2e-bed3-d77ca13c4a44",
      "name": "–û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É",
      "credentials": {
        "postgres": {
          "id": "EbeJgvGxJbetfB8O",
          "name": "Postgres local"
        }
      }
    },
    {
      "parameters": {
        "triggerOn": "folder",
        "path": "/data/shared",
        "events": [
          "add",
          "change"
        ],
        "options": {
          "followSymlinks": true,
          "usePolling": true
        }
      },
      "type": "n8n-nodes-base.localFileTrigger",
      "typeVersion": 1,
      "position": [
        -3904,
        -192
      ],
      "id": "8141d1a5-462b-493b-8a40-d6cbcce90d20",
      "name": "–¢—Ä–∏–≥–≥–µ—Ä: –Ω–æ–≤—ã–π —Ñ–∞–π–ª"
    },
    {
      "parameters": {
        "fileSelector": "={{ $('ID —Ñ–∞–π–ª–∞').item.json.file_id }}",
        "options": {
          "dataPropertyName": "=data"
        }
      },
      "type": "n8n-nodes-base.readWriteFile",
      "typeVersion": 1,
      "position": [
        -2896,
        -352
      ],
      "id": "344f248d-d1e4-4f9f-9a9b-e70d080bb66a",
      "name": "–ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª"
    },
    {
      "parameters": {
        "model": "nomic-embed-text:latest"
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOllama",
      "typeVersion": 1,
      "position": [
        -1824,
        0
      ],
      "id": "83a79fdd-5278-4b1e-9bf4-a66b60958328",
      "name": "–≠–º–±–µ–¥–¥–∏–Ω–≥–∏",
      "credentials": {
        "ollamaApi": {
          "id": "xIPiDM6BmW448qG5",
          "name": "Ollama account"
        }
      }
    },
    {
      "parameters": {
        "chunkSize": 300,
        "chunkOverlap": 30,
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter",
      "typeVersion": 1,
      "position": [
        -1552,
        112
      ],
      "id": "8fbb83a3-db0b-4db8-9a75-9dd4563407b5",
      "name": "–†–∞–∑–±–∏–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "DO $$\nBEGIN\n    IF EXISTS (SELECT 1 FROM information_schema.tables WHERE table_name = 'documents_pg') THEN\n        EXECUTE 'DELETE FROM documents_pg WHERE metadata->>''file_id'' LIKE ''%' || $1 || '%''';\n    END IF;\nEND\n$$;",
        "options": {
          "queryReplacement": "={{ $json.file_id }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -3344,
        -224
      ],
      "id": "cd0d83a7-49b9-427e-acc0-86abb75b1ff6",
      "name": "–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –≤–µ–∫—Ç–æ—Ä—ã",
      "credentials": {
        "postgres": {
          "id": "EbeJgvGxJbetfB8O",
          "name": "Postgres local"
        }
      }
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "DELETE FROM document_rows\nWHERE dataset_id LIKE '%' || $1 || '%';",
        "options": {
          "queryReplacement": "={{ $('ID —Ñ–∞–π–ª–∞').item.json.file_id }}"
        }
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -3184,
        -336
      ],
      "id": "bf537dae-c38b-4f3b-bc8e-19e8c29f3219",
      "name": "–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å—Ç—Ä–æ–∫–∏",
      "credentials": {
        "postgres": {
          "id": "EbeJgvGxJbetfB8O",
          "name": "Postgres local"
        }
      }
    },
    {
      "parameters": {
        "mode": "insert",
        "tableName": "documents_pg",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1,
      "position": [
        -1632,
        -224
      ],
      "id": "a9695457-b1b5-4d18-ade9-43ab770ad806",
      "name": "–í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ",
      "credentials": {
        "postgres": {
          "id": "EbeJgvGxJbetfB8O",
          "name": "Postgres local"
        }
      }
    },
    {
      "parameters": {},
      "type": "n8n-nodes-base.manualTrigger",
      "typeVersion": 1,
      "position": [
        -3840,
        -1024
      ],
      "id": "4c5624be-31b9-4c0b-9a4c-24ef4a42f038",
      "name": "–ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏"
    },
    {
      "parameters": {
        "operation": "executeQuery",
        "query": "-- ============================================\n-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è RAG —Å–∏—Å—Ç–µ–º—ã\n-- –°–∫—Ä–∏–ø—Ç –±–µ–∑–æ–ø–∞—Å–µ–Ω –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è\n-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –º–∏–≥—Ä–∏—Ä—É–µ—Ç —Å—Ç–∞—Ä—É—é —Å—Ö–µ–º—É –µ—Å–ª–∏ –Ω—É–∂–Ω–æ\n-- ============================================\n\n-- 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è pgvector –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–µ–∫—Ç–æ—Ä–Ω—ã–º–∏ —ç–º–±–µ–¥–¥–∏–Ω–≥–∞–º–∏\nCREATE EXTENSION IF NOT EXISTS vector;\n\n-- 2. –°–æ–∑–¥–∞–Ω–∏–µ –∏–ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã documents_pg\nDO $$ \nBEGIN\n    -- –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ —Ç–∞–±–ª–∏—Ü–∞\n    IF NOT EXISTS (SELECT FROM pg_tables WHERE schemaname = 'public' AND tablename = 'documents_pg') THEN\n        -- –¢–∞–±–ª–∏—Ü–∞ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - —Å–æ–∑–¥–∞—ë–º —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ö–µ–º–æ–π\n        CREATE TABLE documents_pg (\n            id BIGSERIAL PRIMARY KEY,\n            text TEXT,\n            metadata JSONB,\n            embedding vector(768)\n        );\n        RAISE NOTICE '–¢–∞–±–ª–∏—Ü–∞ documents_pg —Å–æ–∑–¥–∞–Ω–∞';\n    ELSE\n        -- –¢–∞–±–ª–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç - –ø—Ä–æ–≤–µ—Ä—è–µ–º, –Ω—É–∂–Ω–∞ –ª–∏ –º–∏–≥—Ä–∞—Ü–∏—è –∫–æ–ª–æ–Ω–∫–∏ content -> text\n        IF EXISTS (SELECT FROM information_schema.columns WHERE table_name = 'documents_pg' AND column_name = 'content') \n           AND NOT EXISTS (SELECT FROM information_schema.columns WHERE table_name = 'documents_pg' AND column_name = 'text') THEN\n            -- –ü–µ—Ä–µ–∏–º–µ–Ω–æ–≤—ã–≤–∞–µ–º –∫–æ–ª–æ–Ω–∫—É content –≤ text –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å LangChain\n            ALTER TABLE documents_pg RENAME COLUMN content TO text;\n            RAISE NOTICE '–ö–æ–ª–æ–Ω–∫–∞ content –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∞ –≤ text';\n        ELSE\n            RAISE NOTICE '–¢–∞–±–ª–∏—Ü–∞ documents_pg —É–∂–µ –≤ –∞–∫—Ç—É–∞–ª—å–Ω–æ–º —Å–æ—Å—Ç–æ—è–Ω–∏–∏';\n        END IF;\n    END IF;\nEND $$;\n\n-- 3. –ò–Ω–¥–µ–∫—Å –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –≤–µ–∫—Ç–æ—Ä–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ (HNSW - —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –¥–∞–Ω–Ω—ã—Ö)\nCREATE INDEX IF NOT EXISTS documents_pg_embedding_idx \n    ON documents_pg \n    USING hnsw (embedding vector_cosine_ops);\n\n-- 4. –¢–∞–±–ª–∏—Ü–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤\nCREATE TABLE IF NOT EXISTS document_metadata (\n    id TEXT PRIMARY KEY,\n    title TEXT,\n    created_at TIMESTAMP DEFAULT NOW(),\n    schema TEXT\n);\n\n-- 5. –¢–∞–±–ª–∏—Ü–∞ —Å—Ç—Ä–æ–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ (–¥–ª—è —Ç–∞–±–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö CSV/Excel)\nDO $$ \nBEGIN\n    IF NOT EXISTS (SELECT FROM pg_tables WHERE schemaname = 'public' AND tablename = 'document_rows') THEN\n        CREATE TABLE document_rows (\n            id SERIAL PRIMARY KEY,\n            dataset_id TEXT REFERENCES document_metadata(id) ON DELETE CASCADE,\n            row_data JSONB\n        );\n        CREATE INDEX idx_document_rows_dataset_id ON document_rows(dataset_id);\n        RAISE NOTICE '–¢–∞–±–ª–∏—Ü–∞ document_rows —Å–æ–∑–¥–∞–Ω–∞';\n    ELSE\n        RAISE NOTICE '–¢–∞–±–ª–∏—Ü–∞ document_rows —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç';\n    END IF;\nEND $$;\n\n-- ============================================\n-- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ\n-- ============================================",
        "options": {}
      },
      "type": "n8n-nodes-base.postgres",
      "typeVersion": 2.5,
      "position": [
        -3616,
        -1024
      ],
      "id": "aa6c541f-9d7f-443b-8510-b3ab3293cc46",
      "name": "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î –¥–ª—è RAG",
      "credentials": {
        "postgres": {
          "id": "EbeJgvGxJbetfB8O",
          "name": "Postgres local"
        }
      }
    },
    {
      "parameters": {
        "content": "# RAG L.I.S.A.\n**–õ–æ–∫–∞–ª—å–Ω–∞—è –ò–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω–∞—è –°–∏—Å—Ç–µ–º–∞ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏**\n\n–ê–≤—Ç–æ—Ä: [Nikita Shorin](https://www.youtube.com/@shorin_nikita)\n\n---\n\n## –ß—Ç–æ —ç—Ç–æ?\nAI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –≤–∞—à–∏–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º. –ó–∞–≥—Ä—É–∂–∞–µ—Ç–µ —Ñ–∞–π–ª—ã ‚Äî –æ–Ω –∏—Ö –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∏ –∏—â–µ—Ç –æ—Ç–≤–µ—Ç—ã.\n\n---\n\n## 3 —á–∞—Å—Ç–∏ workflow\n\n### üü£ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î\n–ó–∞–ø—É—Å—Ç–∏—Ç–µ **–æ–¥–∏–Ω —Ä–∞–∑** –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ.\n–°–æ–∑–¥–∞—ë—Ç —Ç–∞–±–ª–∏—Ü—ã –≤ PostgreSQL –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤.\n\n### üü¢ AI Agent (L.I.S.A.)\n–û—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.\n- –ò—â–µ—Ç –ø–æ —Å–º—ã—Å–ª—É –≤ —Ç–µ–∫—Å—Ç–∞—Ö (RAG)\n- –î–µ–ª–∞–µ—Ç SQL-–∑–∞–ø—Ä–æ—Å—ã –∫ —Ç–∞–±–ª–∏—Ü–∞–º (CSV/Excel)\n- –ü–æ–º–Ω–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç –¥–∏–∞–ª–æ–≥–∞\n\n### üü° –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö\n–°–ª–µ–¥–∏—Ç –∑–∞ –ø–∞–ø–∫–æ–π ‚Äî –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω–¥–µ–∫—Å–∏—Ä—É—é—Ç—Å—è.\n- **CSV, Excel** ‚Üí —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∫–∞–∫ —Ç–∞–±–ª–∏—Ü—É + –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å\n- **TXT, PDF** ‚Üí —Ç–æ–ª—å–∫–æ –≤–µ–∫—Ç–æ—Ä–Ω—ã–π –∏–Ω–¥–µ–∫—Å\n\n---\n\n## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç\n\n1. **PostgreSQL** ‚Äî –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ credentials [host: db], [password: –∏–∑ —Ñ–∞–π–ª–∞ .env]\n2. **Ollama** ‚Äî [url:  http://ollama:11434]\n3. **LLM** ‚Äî OpenRouter / OpenAI / Ollama (—Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π tools)\n4. **–ü–∞–ø–∫–∞** ‚Äî —É–∫–∞–∂–∏—Ç–µ –ø—É—Ç—å –≤ Local File Trigger\n5. **–ó–∞–ø—É—Å–∫** ‚Äî –Ω–∞–∂–º–∏—Ç–µ Execute –Ω–∞ –Ω–æ–¥–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏\n\n---\n\n## –ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤\n\n**–ö —Ç–∞–±–ª–∏—Ü–∞–º:**\n- ¬´–ü–æ–∫–∞–∂–∏ —Ç–æ–ø-5 –ø–æ —Ü–µ–Ω–µ¬ª\n- ¬´–°–∫–æ–ª—å–∫–æ –∑–∞–ø–∏—Å–µ–π —Å–æ —Å—Ç–∞—Ç—É—Å–æ–º X?¬ª\n\n**–ö —Ç–µ–∫—Å—Ç–∞–º:**\n- ¬´–ö–∞–∫–∏–µ —É—Å–ª–æ–≤–∏—è –¥–æ—Å—Ç–∞–≤–∫–∏?¬ª\n- ¬´–†–∞—Å—Å–∫–∞–∂–∏ –ø—Ä–æ –≥–∞—Ä–∞–Ω—Ç–∏—é¬ª\n\n---\n\n[@PrideAIBot](https://t.me/PrideAIBot)",
        "height": 1456,
        "width": 480,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -4480,
        -1248
      ],
      "id": "40cad863-afa8-489c-99dc-70303cb8d8e0",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "",
        "height": 256,
        "width": 464,
        "color": 6
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3888,
        -1072
      ],
      "id": "c4a4a784-69bb-45a5-975b-e9b2ce355219",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "",
        "height": 672,
        "width": 1312,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3280,
        -1376
      ],
      "id": "11ce9643-be51-492e-9584-1df89c9215be",
      "name": "Sticky Note2"
    },
    {
      "parameters": {
        "content": "",
        "height": 912,
        "width": 2736
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -3952,
        -672
      ],
      "id": "b6154899-26f5-46b9-bf20-6e643453555a",
      "name": "Sticky Note3"
    },
    {
      "parameters": {},
      "id": "df6231df-7c28-430a-b8fe-40ef5a7dd18d",
      "name": "Chat Memory",
      "type": "@n8n/n8n-nodes-langchain.memoryPostgresChat",
      "typeVersion": 1,
      "position": [
        -2864,
        -1024
      ],
      "notesInFlow": false,
      "credentials": {
        "postgres": {
          "id": "EbeJgvGxJbetfB8O",
          "name": "Postgres local"
        }
      }
    },
    {
      "parameters": {
        "options": {}
      },
      "id": "cf08da8f-08db-4f2f-873d-2305b19abf9c",
      "name": "Response",
      "type": "n8n-nodes-base.respondToWebhook",
      "typeVersion": 1.1,
      "position": [
        -2176,
        -1248
      ]
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "9a9a245e-f1a1-4282-bb02-a81ffe629f0f",
              "name": "chatInput",
              "value": "={{ $json?.chatInput || $json.body.chatInput }}",
              "type": "string"
            },
            {
              "id": "b80831d8-c653-4203-8706-adedfdb98f77",
              "name": "sessionId",
              "value": "={{ $json?.sessionId || $json.body.sessionId}}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "id": "b4598d2b-a841-4d8b-8fc9-118b7720c334",
      "name": "Prepare Input",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -2992,
        -1248
      ]
    },
    {
      "parameters": {
        "public": true,
        "options": {}
      },
      "id": "dc216717-29d0-4633-bb0f-73f322d8b301",
      "name": "Chat Trigger",
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.1,
      "position": [
        -3232,
        -1280
      ],
      "webhookId": "e104e40e-6134-4825-a6f0-8a646d882662"
    },
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "bf4dd093-bb02-472c-9454-7ab9af97bd1d",
        "responseMode": "responseNode",
        "options": {}
      },
      "id": "a772a100-3511-49bc-b6f9-e6dd228bf4d6",
      "name": "Webhook API",
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -3232,
        -1120
      ],
      "webhookId": "bf4dd093-bb02-472c-9454-7ab9af97bd1d"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatOpenRouter",
      "typeVersion": 1,
      "position": [
        -2992,
        -1024
      ],
      "id": "d10bd9a1-957a-4110-a7de-fb3871c7c818",
      "name": "LLM",
      "credentials": {
        "openRouterApi": {
          "id": "a9ysnNwmelA3wMpm",
          "name": "OpenRouter account"
        }
      }
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "# –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π RAG + SQL –ê—Å—Å–∏—Å—Ç–µ–Ω—Ç\n\n–¢—ã ‚Äî –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π –∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –∑–Ω–∞–Ω–∏–π. –¢—ã —É–º–µ–µ—à—å –∏—Å–∫–∞—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ö (RAG) –∏ –≤—ã–ø–æ–ª–Ω—è—Ç—å SQL-–∑–∞–ø—Ä–æ—Å—ã –∫ —Ç–∞–±–ª–∏—á–Ω—ã–º –¥–∞–Ω–Ω—ã–º (CSV, Excel).\n\n## –î–û–°–¢–£–ü–ù–´–ï –ò–ù–°–¢–†–£–ú–ï–ù–¢–´\n\n### 1. List Documents\n–ü–û–ö–ê–ó–´–í–ê–ï–¢ –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Å—Ö–µ–º—É —Ç–∞–±–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.\n**–í–°–ï–ì–î–ê –Ω–∞—á–∏–Ω–∞–π —Å —ç—Ç–æ–≥–æ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞**, –µ—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö!\n\n### 2. Query Document Rows (SQL)\n–î–ª—è —Ç–∞–±–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (CSV, Excel). –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `row_data` (JSONB).\n\n**–°–∏–Ω—Ç–∞–∫—Å–∏—Å:**\n```sql\nSELECT row_data->>'–ø–æ–ª–µ' as alias\nFROM document_rows\nWHERE row_data->>'–ø–æ–ª–µ' = '–∑–Ω–∞—á–µ–Ω–∏–µ'\n  AND (row_data->>'—á–∏—Å–ª–æ')::numeric > 100\n  AND row_data->>'—Ç–µ–∫—Å—Ç' LIKE '%–ø–æ–¥—Å—Ç—Ä–æ–∫–∞%'\nORDER BY (row_data->>'–ø–æ–ª–µ')::numeric\nLIMIT 10;\n```\n\n**–û–ø–µ—Ä–∞—Ü–∏–∏:**\n- –¢–µ–∫—Å—Ç: `row_data->>'–ø–æ–ª–µ' = '–∑–Ω–∞—á–µ–Ω–∏–µ'`, `LIKE '%...%'`, `ILIKE` (–±–µ–∑ —É—á—ë—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞)\n- –ß–∏—Å–ª–∞: `(row_data->>'–ø–æ–ª–µ')::numeric`, `::int` –¥–ª—è —Å—Ä–∞–≤–Ω–µ–Ω–∏–π –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏\n- –ê–≥—Ä–µ–≥–∞—Ü–∏—è: `COUNT(*)`, `SUM()`, `AVG()`, `MAX()`, `MIN()`\n- –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞: `GROUP BY row_data->>'–ø–æ–ª–µ'`\n\n### 3. RAG Search (documents)\n–î–ª—è —Ç–µ–∫—Å—Ç–æ–≤—ã—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ ‚Äî –ø–æ–∏—Å–∫ –ø–æ —Å–º—ã—Å–ª—É. –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è:\n- –û–±—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤, –∫–æ–Ω—Ü–µ–ø—Ü–∏–π, –æ–ø–∏—Å–∞–Ω–∏–π\n- –ü–æ–∏—Å–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∫–æ—Ç–æ—Ä—É—é —Å–ª–æ–∂–Ω–æ –≤—ã—Ä–∞–∑–∏—Ç—å SQL-–∑–∞–ø—Ä–æ—Å–æ–º\n- FAQ, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n\n### 4. Get File Contents\n–ü–æ–ª—É—á–∏—Ç—å –≤–µ—Å—å —Ç–µ–∫—Å—Ç –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ file_id.\n\n## –°–¢–†–ê–¢–ï–ì–ò–Ø –í–´–ë–û–†–ê –ò–ù–°–¢–†–£–ú–ï–ù–¢–ê\n\n```\n–í–æ–ø—Ä–æ—Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n        ‚Üì\n‚îå‚îÄ –ù—É–∂–Ω—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏? ‚îÄ‚Üí SQL\n‚îÇ   (–Ω–∞–π–¥–∏ –≤—Å–µ X –≥–¥–µ Y > Z)\n‚îÇ\n‚îú‚îÄ –ù—É–∂–Ω–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏—è/—Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞? ‚îÄ‚Üí SQL\n‚îÇ   (—Å–∫–æ–ª—å–∫–æ –≤—Å–µ–≥–æ, —Å—Ä–µ–¥–Ω—è—è —Ü–µ–Ω–∞, –º–∞–∫—Å–∏–º—É–º)\n‚îÇ\n‚îú‚îÄ –í–æ–ø—Ä–æ—Å –ø—Ä–æ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏/–ø—Ä–∞–≤–∏–ª–∞/–æ–ø–∏—Å–∞–Ω–∏—è? ‚îÄ‚Üí RAG\n‚îÇ   (—á—Ç–æ —Ç–∞–∫–æ–µ, –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç, –∫–∞–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞)\n‚îÇ\n‚îî‚îÄ –ù–µ –∑–Ω–∞–µ—à—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö? ‚îÄ‚Üí List Documents\n```\n\n## –ê–õ–ì–û–†–ò–¢–ú –†–ê–ë–û–¢–´\n\n1. **–ü–æ–Ω—è—Ç—å –∑–∞–ø—Ä–æ—Å** ‚Äî —á—Ç–æ –∏–º–µ–Ω–Ω–æ –∏—â–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å?\n2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ö–µ–º—É** ‚Äî –µ—Å–ª–∏ –Ω–µ –∑–Ω–∞–µ—à—å –ø–æ–ª—è, –≤—ã–∑–æ–≤–∏ List Documents\n3. **–í—ã–±—Ä–∞—Ç—å –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç** ‚Äî SQL –¥–ª—è –¥–∞–Ω–Ω—ã—Ö, RAG –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤\n4. **–í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å** ‚Äî –ø–æ—Å—Ç—Ä–æ–π –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π –∑–∞–ø—Ä–æ—Å\n5. **–û—Ç—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç** ‚Äî –ø–æ–∫–∞–∂–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–Ω—è—Ç–Ω–æ\n\n## –ü–†–ê–í–ò–õ–ê\n\n- **–ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–π —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏** ‚Äî –Ω–µ —É–ø–æ–º–∏–Ω–∞–π SQL, JSONB, row_data, —É—Å–ª–æ–≤–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤. –ü—Ä–æ—Å—Ç–æ –¥–∞–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç!\n- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏ (–∫–∞–∫ –∏—Å–∫–∞–ª, –∫–∞–∫–æ–π –∑–∞–ø—Ä–æ—Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª) ‚Äî –¢–û–õ–¨–ö–û –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–Ω–æ —Å–ø—Ä–æ—Å–∏—Ç\n- –ï—Å–ª–∏ SQL –Ω–µ –≤–µ—Ä–Ω—É–ª —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ ‚Äî –ø–æ–ø—Ä–æ–±—É–π —Å–º—è–≥—á–∏—Ç—å —É—Å–ª–æ–≤–∏—è –∏–ª–∏ –ø—Ä–µ–¥–ª–æ–∂–∏ –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤—ã\n- –ï—Å–ª–∏ RAG –Ω–µ –Ω–∞—à—ë–ª ‚Äî —Å–∫–∞–∂–∏ —á–µ—Å—Ç–Ω–æ, –Ω–µ –≤—ã–¥—É–º—ã–≤–∞–π\n- –î–ª—è —á–∏—Å–ª–æ–≤—ã—Ö —Å—Ä–∞–≤–Ω–µ–Ω–∏–π –í–°–ï–ì–î–ê –ø—Ä–∏–≤–æ–¥–∏ —Ç–∏–ø: `(row_data->>'–ø–æ–ª–µ')::numeric`\n- –ò—Å–ø–æ–ª—å–∑—É–π LIMIT –¥–ª—è –±–æ–ª—å—à–∏—Ö –≤—ã–±–æ—Ä–æ–∫\n- –û—Ç–≤–µ—á–∞–π –Ω–∞ —è–∑—ã–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n\n## –§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê\n\n–ü–ª–æ—Ö–æ:\n\"–ù–∞–π–¥–µ–Ω–æ 5 –∑–∞–ø–∏—Å–µ–π. –ü–æ–∏—Å–∫ –≤—ã–ø–æ–ª–Ω—è–ª—Å—è —Å —É—Å–ª–æ–≤–∏–µ–º (row_data->>'floors')::int = 2...\"\n\n–•–æ—Ä–æ—à–æ:\n\"–í–æ—Ç 5 –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:\n1. –ù–∞–∑–≤–∞–Ω–∏–µ ‚Äî —Ü–µ–Ω–∞ ‚Äî –∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ\n2. ...\""
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 3,
      "position": [
        -2752,
        -1248
      ],
      "id": "5af1a2f8-dc3f-4980-9bca-11202017f87e",
      "name": "RAG Agent"
    },
    {
      "parameters": {
        "model": "nomic-embed-text:latest"
      },
      "type": "@n8n/n8n-nodes-langchain.embeddingsOllama",
      "typeVersion": 1,
      "position": [
        -2192,
        -848
      ],
      "id": "bbbe58a1-0963-4252-bb52-6764fdb1ca33",
      "name": "Embeddings",
      "credentials": {
        "ollamaApi": {
          "id": "xIPiDM6BmW448qG5",
          "name": "Ollama account"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "–°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤ –≤ –±–∞–∑–µ –∑–Ω–∞–Ω–∏–π. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤: –∏–º—è —Ñ–∞–π–ª–∞ (file_name), —Ç–∏–ø (type: csv/excel/text), —Å—Ö–µ–º—É –ø–æ–ª–µ–π (schema) –¥–ª—è —Ç–∞–±–ª–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö. –í–°–ï–ì–î–ê –≤—ã–∑—ã–≤–∞–π —ç—Ç–æ—Ç –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –ø–µ—Ä–≤—ã–º, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å –¥–æ—Å—Ç—É–ø–Ω—ã–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö.",
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "document_metadata",
          "mode": "list",
          "cachedResultName": "document_metadata"
        },
        "returnAll": true,
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.5,
      "position": [
        -2672,
        -1024
      ],
      "id": "16eac7fe-6478-4acd-90e7-67ecf52e5a55",
      "name": "List Docs",
      "credentials": {
        "postgres": {
          "id": "EbeJgvGxJbetfB8O",
          "name": "Postgres local"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "–ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–æ–∫—É–º–µ–Ω—Ç–∞ –ø–æ ID. –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è —á—Ç–µ–Ω–∏—è FAQ –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–π –∏–∑ –±–∞–∑—ã.",
        "operation": "executeQuery",
        "query": "SELECT \n    string_agg(text, ' ') as document_text\nFROM documents_pg\n  WHERE metadata->>'file_id' = $1\nGROUP BY metadata->>'file_id';",
        "options": {
          "queryReplacement": "={{ $fromAI('file_id') }}"
        }
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.5,
      "position": [
        -2544,
        -1024
      ],
      "id": "42721b66-9803-4b05-99f3-ccdd0a2fb8c1",
      "name": "Read Doc",
      "credentials": {
        "postgres": {
          "id": "EbeJgvGxJbetfB8O",
          "name": "Postgres local"
        }
      }
    },
    {
      "parameters": {
        "descriptionType": "manual",
        "toolDescription": "SQL-–∑–∞–ø—Ä–æ—Å—ã –∫ —Ç–∞–±–ª–∏—á–Ω—ã–º –¥–∞–Ω–Ω—ã–º (CSV, Excel). –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ document_rows, –ø–æ–ª—è ‚Äî –≤ –∫–æ–ª–æ–Ω–∫–µ row_data (JSONB).\n\n**–ü–ï–†–ï–î –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï–ú:** –í—ã–∑–æ–≤–∏ List Documents, —á—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å —Å—Ö–µ–º—É –ø–æ–ª–µ–π!\n\n**–°–ò–ù–¢–ê–ö–°–ò–° JSONB:**\n```sql\n-- –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ:\nrow_data->>'–∏–º—è_–ø–æ–ª—è'\n\n-- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞:\nrow_data->>'–ø–æ–ª–µ' = '–∑–Ω–∞—á–µ–Ω–∏–µ'\nrow_data->>'–ø–æ–ª–µ' LIKE '%–ø–æ–¥—Å—Ç—Ä–æ–∫–∞%'\nrow_data->>'–ø–æ–ª–µ' ILIKE '%–±–µ–∑ —Ä–µ–≥–∏—Å—Ç—Ä–∞%'\n\n-- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —á–∏—Å–µ–ª (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–∞!):\n(row_data->>'—á–∏—Å–ª–æ')::numeric > 100\n(row_data->>'—á–∏—Å–ª–æ')::int = 5\n\n-- –°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ —á–∏—Å–ª—É:\nORDER BY (row_data->>'—á–∏—Å–ª–æ')::numeric DESC\n```\n\n**–®–ê–ë–õ–û–ù –ó–ê–ü–†–û–°–ê:**\n```sql\nSELECT \n    row_data->>'–ø–æ–ª–µ1' as –∞–ª–∏–∞—Å1,\n    row_data->>'–ø–æ–ª–µ2' as –∞–ª–∏–∞—Å2\nFROM document_rows\nWHERE row_data->>'—É—Å–ª–æ–≤–∏–µ' = '–∑–Ω–∞—á–µ–Ω–∏–µ'\n    AND (row_data->>'—á–∏—Å–ª–æ')::numeric > 100\nORDER BY (row_data->>'—Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞')::numeric\nLIMIT 10;\n```\n\n**–ê–ì–†–ï–ì–ê–¶–ò–Ø:**\n- COUNT(*), SUM(), AVG(), MAX(), MIN()\n- GROUP BY row_data->>'–ø–æ–ª–µ'\n\n**–°–û–í–ï–¢–´:**\n- –ò—Å–ø–æ–ª—å–∑—É–π LIMIT –¥–ª—è –±–æ–ª—å—à–∏—Ö –≤—ã–±–æ—Ä–æ–∫\n- –î–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ–¥—Å—Ç—Ä–æ–∫–∏: LIKE '%—Ç–µ–∫—Å—Ç%'\n- –î–ª—è –ø–æ–∏—Å–∫–∞ –±–µ–∑ —É—á—ë—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞: ILIKE",
        "operation": "executeQuery",
        "query": "{{ $fromAI('sql_query') }}",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.5,
      "position": [
        -2400,
        -1024
      ],
      "id": "505974e0-e8e3-43cd-a8a6-450224ac69c5",
      "name": "SQL Query",
      "credentials": {
        "postgres": {
          "id": "EbeJgvGxJbetfB8O",
          "name": "Postgres local"
        }
      }
    },
    {
      "parameters": {
        "mode": "retrieve-as-tool",
        "toolName": "documents",
        "toolDescription": "–°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π (–≤–µ–∫—Ç–æ—Ä–Ω—ã–π) –ø–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç–æ–≤—ã–º –¥–æ–∫—É–º–µ–Ω—Ç–∞–º. –ò—Å–ø–æ–ª—å–∑—É–π –¥–ª—è:\n- –í–æ–ø—Ä–æ—Å–æ–≤ –æ –∫–æ–Ω—Ü–µ–ø—Ü–∏—è—Ö, –ø—Ä–∞–≤–∏–ª–∞—Ö, –æ–ø–∏—Å–∞–Ω–∏—è—Ö\n- –ü–æ–∏—Å–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –∏–∑ FAQ, –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–π, –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏\n- –ó–∞–ø—Ä–æ—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ —Å–ª–æ–∂–Ω–æ –≤—ã—Ä–∞–∑–∏—Ç—å —Ç–æ—á–Ω—ã–º SQL-—É—Å–ª–æ–≤–∏–µ–º\n\n–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π –¥–ª—è:\n- –ü–æ–∏—Å–∫–∞ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏ ‚Äî –¥–ª—è —ç—Ç–æ–≥–æ SQL\n- –ê–≥—Ä–µ–≥–∞—Ü–∏–∏ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ ‚Äî –¥–ª—è —ç—Ç–æ–≥–æ SQL\n\n–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–µ —Ñ—Ä–∞–≥–º–µ–Ω—Ç—ã —Ç–µ–∫—Å—Ç–∞ –ø–æ —Å–º—ã—Å–ª—É –∑–∞–ø—Ä–æ—Å–∞.",
        "tableName": "documents_pg",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.vectorStorePGVector",
      "typeVersion": 1,
      "position": [
        -2288,
        -1024
      ],
      "id": "e0d6bdf2-03bc-45ad-b0fa-15cc291a6443",
      "name": "RAG Search",
      "credentials": {
        "postgres": {
          "id": "EbeJgvGxJbetfB8O",
          "name": "Postgres local"
        }
      }
    }
  ],
  "pinData": {
    "–¢—Ä–∏–≥–≥–µ—Ä: –Ω–æ–≤—ã–π —Ñ–∞–π–ª": [
      {
        "json": {
          "event": "change",
          "path": "/data/shared/–î—É–±–æ–≤—ã–∏ÃÜ –∫–≤–∞—Ä—Ç–∞–ª ‚Äì –¥–æ–º–∞ - PrideAIBot.csv"
        }
      }
    ]
  },
  "connections": {
    "–ó–∞–≥—Ä—É–∑—á–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤": {
      "ai_document": [
        [
          {
            "node": "–í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ",
            "type": "ai_document",
            "index": 0
          }
        ]
      ]
    },
    "–ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç (TXT)": {
      "main": [
        [
          {
            "node": "–í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ID —Ñ–∞–π–ª–∞": {
      "main": [
        [
          {
            "node": "–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –≤–µ–∫—Ç–æ—Ä—ã",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç (PDF)": {
      "main": [
        [
          {
            "node": "–í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ê–≥—Ä–µ–≥–∞—Ü–∏—è": {
      "main": [
        [
          {
            "node": "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–û–±—ä–µ–¥–∏–Ω–∏—Ç—å": {
      "main": [
        [
          {
            "node": "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É",
            "type": "main",
            "index": 0
          },
          {
            "node": "–í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–¢–∏–ø —Ñ–∞–π–ª–∞": {
      "main": [
        [
          {
            "node": "–ò–∑–≤–ª–µ—á—å –∏–∑ CSV",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ò–∑–≤–ª–µ—á—å –∏–∑ Excel",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç (TXT)",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "–ò–∑–≤–ª–µ—á—å —Ç–µ–∫—Å—Ç (PDF)",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ò–∑–≤–ª–µ—á—å –∏–∑ Excel": {
      "main": [
        [
          {
            "node": "–ê–≥—Ä–µ–≥–∞—Ü–∏—è",
            "type": "main",
            "index": 0
          },
          {
            "node": "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä–æ–∫–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É": {
      "main": [
        [
          {
            "node": "–û–±–Ω–æ–≤–∏—Ç—å —Å—Ö–µ–º—É",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ò–∑–≤–ª–µ—á—å –∏–∑ CSV": {
      "main": [
        [
          {
            "node": "–ê–≥—Ä–µ–≥–∞—Ü–∏—è",
            "type": "main",
            "index": 0
          },
          {
            "node": "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å —Å—Ç—Ä–æ–∫–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–¶–∏–∫–ª –ø–æ —Ñ–∞–π–ª–∞–º": {
      "main": [
        [],
        [
          {
            "node": "ID —Ñ–∞–π–ª–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ": {
      "main": [
        [
          {
            "node": "–ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–¢—Ä–∏–≥–≥–µ—Ä: –Ω–æ–≤—ã–π —Ñ–∞–π–ª": {
      "main": [
        [
          {
            "node": "–¶–∏–∫–ª –ø–æ —Ñ–∞–π–ª–∞–º",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ü—Ä–æ—á–∏—Ç–∞—Ç—å —Ñ–∞–π–ª": {
      "main": [
        [
          {
            "node": "–¢–∏–ø —Ñ–∞–π–ª–∞",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–≠–º–±–µ–¥–¥–∏–Ω–≥–∏": {
      "ai_embedding": [
        [
          {
            "node": "–í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "–†–∞–∑–±–∏–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞": {
      "ai_textSplitter": [
        [
          {
            "node": "–ó–∞–≥—Ä—É–∑—á–∏–∫ –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤",
            "type": "ai_textSplitter",
            "index": 0
          }
        ]
      ]
    },
    "–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ –≤–µ–∫—Ç–æ—Ä—ã": {
      "main": [
        [
          {
            "node": "–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å—Ç—Ä–æ–∫–∏",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–£–¥–∞–ª–∏—Ç—å —Å—Ç–∞—Ä—ã–µ —Å—Ç—Ä–æ–∫–∏": {
      "main": [
        [
          {
            "node": "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–í–µ–∫—Ç–æ—Ä–Ω–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ": {
      "main": [
        [
          {
            "node": "–¶–∏–∫–ª –ø–æ —Ñ–∞–π–ª–∞–º",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "–ó–∞–ø—É—Å–∫ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏": {
      "main": [
        [
          {
            "node": "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î –¥–ª—è RAG",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "RAG Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "Prepare Input": {
      "main": [
        [
          {
            "node": "RAG Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Chat Trigger": {
      "main": [
        [
          {
            "node": "Prepare Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Webhook API": {
      "main": [
        [
          {
            "node": "Prepare Input",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "LLM": {
      "ai_languageModel": [
        [
          {
            "node": "RAG Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "RAG Agent": {
      "main": [
        [
          {
            "node": "Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Embeddings": {
      "ai_embedding": [
        [
          {
            "node": "RAG Search",
            "type": "ai_embedding",
            "index": 0
          }
        ]
      ]
    },
    "List Docs": {
      "ai_tool": [
        [
          {
            "node": "RAG Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Read Doc": {
      "ai_tool": [
        [
          {
            "node": "RAG Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "SQL Query": {
      "ai_tool": [
        [
          {
            "node": "RAG Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "RAG Search": {
      "ai_tool": [
        [
          {
            "node": "RAG Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "cd08b708-cbdc-4eef-a553-ba8415e39052"
}